<!-- Desenvolvido por Paulo Moisés. Em dúvidas sobre a edição, entre em contato pelo site: www.paulomoises.com ou pelo email: paulomoises_silva@hotmail.com -->
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/numeral.js/2.0.6/numeral.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/numeral.js/2.0.6/locales/pt-br.min.js"></script>
<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyArffpRRcX7uR27n-g_CrYsQk_ZlFT9_iw&libraries=places"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/datepicker/0.6.5/datepicker.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/datepicker/0.6.5/datepicker.css">
<div class="card">
    <div class="card-header">
        <h4>Nova Proposta Consultoria Imobiliária</h4>
        <small class="text-info">Preencha os campos abaixo para construir a proposta de orçamento do
            cliente.</small>
    </div>
    <div id="forms" class="card-body">
        <form id="form" onsubmit="return novaProposta(event)">
            <div class="form-group">
                <label for="codigoproposta">Código da Proposta</label>
                <input type="text" class="form-control" id="codigoproposta" placeholder="Insira o código da proposta" required>
            </div>
            <div class="form-group">
                <label for="pessoa">Pessoa Física ou Jurídica</label>
                <select class="form-control" id="pessoa" required>
                        <option disabled selected>Selecione</option>
                        <option>Física</option>
                        <option>Juríduca</option>
                    </select>
            </div>
            <div class="form-group">
                <label for="nomefantasia">Nome da Empresa</label>
                <input type="text" class="form-control" id="nomefantasia" placeholder="Insira o Nome da Empresa" required>
            </div>
            <div class="form-group">
                <label for="saudacao">Saudação</label>
                <select class="form-control" id="saudacao" required>
                    <option disabled selected>Selecione</option>
                    <option>Sr.</option>
                    <option>Sra.</option>
                </select>
            </div>
            <div class="form-group">
                <label for="nomecliente">Nome do Cliente</label>
                <input type="text" class="form-control" id="nomecliente" placeholder="Insira o Nome do Cliente" required>
            </div>
            <div class="form-group">
                <label for="cidadeproposta">Nome da Cidade</label>
                <input type="text" class="form-control" id="cidadeproposta" value="Belo Horizonte" placeholder="Insira o Nome da Cidade" required>
            </div>
            <div class="form-group">
                <label for="datafundacao">Data da Proposta</label>
                <input type='text' class="form-control input-data hoje" id='datafundacao' required>
            </div>
            <div class="form-group">
                <label for="objetivo-prop">Objetivo da avaliação</label>
                <input type="text" id="objetivo-prop" class="form-control" value="para atendimento ao CPC 01 (Teste de Impairment)" required>
            </div>
            <div class="form-group">
                <label for="incluitranslado">Esta proposta contempla os gastos com traslados?</label>
                <select class="form-control" id="incluitranslado" required>
                        <option disabled selected>Selecione</option>
                        <option value="sim">Sim</option>
                        <option value="não">Não</option>
                    </select>
            </div>
            <div class="row">
                <div class="col-md-4 col-12 form-group">
                    <label for="valortotal">Valor Total</label>
                    <input type="text" class="form-control reais" id="valortotal" placeholder="" required>
                </div>
                <div class="col-md-4 col-12 form-group">
                    <label for="valorass">Valor de Sinal (60%)</label>
                    <input type="text" class="form-control reais" id="valorass" placeholder="" readonly>
                </div>
                <div class="col-md-4 col-12 form-group">
                    <label for="valorent">Valor na Entrega (40%)</label>
                    <input type="text" class="form-control reais" id="valorent" placeholder="" readonly>
                </div>
            </div>
            <div class="form-group">
                <label for="imoveis">Inserir endereço de imóveis</label>
                <textarea class="form-control" id="imoveis" rows="4" required>Imóvel composto terreno, edificações e benfeitorias (Empresa) exceto edificação “FCH III”, localizado à Rua Cobre, Nº 200 - Cruzeiro Belo Horizonte/ MG, CEP 30310-190.</textarea>
                <small>Dê <strong>enter</strong> para adicionar mais de um endereço</small>
            </div>
            <div class="form-group">
                <label for="impostos">Impostos</label>
                <select class="form-control" id="impostos" required>
                    <option disabled selected>Selecione</option>
                    <option value="com">Valor com imposto</option>
                    <option value="sem">Valor sem imposto</option>
                </select>
                <small class="text-info" id="resultadoimposto"></small>
            </div>
            <input class="btn btn-primary btn-lg btn-block" type="submit" id="gerar" value="Gerar Proposta">
        </form>
        <br />
        <div class="btn btn-success btn-lg btn-block" id="acessarproposta" hidden>Acessar Proposta</div>
    </div>
</div>
<div id="waitasec" class="waitasec">
    <img style="position: absolute; left: 40%; top: 40%;" src="https://www.tekkno.com.br/loja/assets/img/carregando.jpg" alt="" width="200">
</div>
<style>
    .waitasec {
        position: fixed;
        left: 0px;
        top: 0px;
        width: 100vw;
        height: 100vh;
        background-color: rgba(19, 40, 78, 0.9);
        display: none;
        cursor: wait;
    }
</style>
<script>
    String.prototype.capitalize = function() {
        return this.charAt(0).toUpperCase() + this.slice(1);
    }

    function camposReq() {
        $("[required]").each(function(x) {
            var abc = $($($("[required]")[x]).prev())
            $(abc).html($(abc).html() + "*")
        })
    }

    $(camposReq())

    $(function() {
        $("#pessoa").on("change", function() {
            if ($("#pessoa").val() == "Física") {
                $("#nomefantasia").attr("required", false)
                $("#nomefantasia").prev().html("Nome da Empresa")
            } else {
                $("#nomefantasia").attr("required", true)
                $("#nomefantasia").prev().html("Nome da Empresa*")
            }
        })
    })

    $(function() {
        $('#valortotal').on("change", function() {
            $('#valortotal').val(numeral($('#valortotal').val()).format('$0,0.00'))
            $('#valorass').val(numeral(numeral($('#valortotal').val()).value() * 0.6).format('$0,0.00'))
            $('#valorent').val(numeral(numeral($('#valortotal').val()).value() * 0.4).format('$0,0.00'))
        })
    })

    $(function() {
        $('#impostos').on("change", function() {
            let val = $('#impostos').val()
            let imp = $('#resultadoimposto')
            if (val == "com") {
                imp.html("Os honorários descritos acima são líquidos de PIS (0,65%), COFINS (3,0%) e ISS (5%). Portanto, a empresa contratante pagará à Investor o valor bruto dos serviços.")
            } else {
                imp.html("Os referidos honorários abrangem todos os tributos (impostos, taxas, emolumentos, contribuições fiscais e parafiscais).")
            }
        })
    })

    $(function() {
        $('.input-data').datepicker({
            format: 'dd/mm/yyyy'
        });
    });

    $(function() {
        var data = new Date()
        var dia = data.getDate()
        var mes = data.getMonth() + 1
        var ano = data.getFullYear()
        if (dia.toString().length != 2) {
            dia = "0" + dia.toString()
        }
        if (mes.toString().length != 2) {
            mes = "0" + mes.toString()
        }
        $('.hoje').val(dia + "/" + mes + "/" + ano)

        function codSeq(a) {
            var cid = a[0][0].toString()
            var seq = a[0][1].toString()
            var ano = a[0][2].toString()
            if (cid.length != 2) {
                cid = "0" + cid
            }
            while (seq.length != 4) {
                seq = "0" + seq
            }
            var data = cid + seq + ano
            $('#codigoproposta').val(data)
        }

        function failure() {
            alert("Não foi possível recuperar o código da proposta.")
        }
        google.script.run.withSuccessHandler(codSeq).withFailureHandler().getProp()
    })

    function whichMon(a) {
        var m = ["janeiro", "fevereiro", "março", "abril", "maio", "junho", "julho", "agosto", "setembro", "outubro", "novembro", "dezembro"]
        var r = m[(a - 1)]
        return r
    }

    function novaProposta(e) {

        e.preventDefault()
        $("#gerar").attr("disabled", true)
        $("#waitasec").show()

        var array1 = getDataForm()

        function success(url) {
            $("#waitasec").hide()
            $("#acessarproposta").attr("hidden", false)
            $("#acessarproposta").attr("link", url)
            alert("Proposta Gerada")
        }

        function failure(e) {
            $("#waitasec").hide()
            $("#gerar").attr("disabled", false)
            alert("Erro em gerar proposta.")
            console.error(e)
        }

        google.script.run.withSuccessHandler(success).withFailureHandler(failure).propostaCI(array1)

        return false
    }

    function getDataForm() {
        var form = $("#form")[0]
        var n = form.length
        var array1 = [
            [],
            []
        ]
        var obj1 = {}

        for (i = 0; i < n; i++) {
            obj1[$(form[i]).attr("id")] = $(form[i]).val()
        }
        var obj2 = JSON.stringify(obj1)

        return obj2
    }

    $("#acessarproposta").on("click", function() {
        window.open($("#acessarproposta").attr("link"))
    })
    $(function() {
        let data = new Date()
        let ano = data.getFullYear() - 1
        let lAno = ano - 2
        let frase = lAno + " à " + ano
        $('.ultimos3anos').val(frase)
    })
</script>