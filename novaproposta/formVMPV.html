<!DOCTYPE html>
<!-- Desenvolvido por Paulo Moisés. Em dúvidas sobre a edição, entre em contato pelo site: www.paulomoises.com ou pelo email: paulomoises_silva@hotmail.com -->
<html lang="pt">

<head>
    <meta charset="UTF-8">
    <base target="_top">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"
        integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <link rel="shortcut icon" type="image/png"
        href="https://investorcp.com/wp-content/uploads/2019/05/investorcp.com-favicon.png" />
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/numeral.js/2.0.6/numeral.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/datepicker/0.6.5/datepicker.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/datepicker/0.6.5/datepicker.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"
        integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"
        integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
        crossorigin="anonymous"></script>
    <script src="https://kit.fontawesome.com/bdaea6cd67.js"></script>
    <script src="https://unpkg.com/gijgo@1.9.13/js/gijgo.min.js" type="text/javascript"></script>
    <link href="https://unpkg.com/gijgo@1.9.13/css/gijgo.min.css" rel="stylesheet" type="text/css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.inputmask/3.1.62/jquery.inputmask.bundle.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.js"></script>
    <script type="text/javascript"
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyArffpRRcX7uR27n-g_CrYsQk_ZlFT9_iw&libraries=places"></script>
    <link rel="stylesheet" href="../style.css">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Nova Proposta</title>
</head>

<body>
    <div id="nav">
    </div>
    <div class="card">
        <div class="card-header">
            <h4>Nova Proposta VMPV</h4>
            <small class="text-info">Preencha os campos abaixo para construir a proposta de orçamento do
                cliente.</small>
        </div>
        <div id="forms" class="card-body">
            <form id="form" onsubmit="return novaProposta(event)">
                <div class="form-group">
                    <label for="codigoproposta">Código da Proposta</label>
                    <input type="text" class="form-control" id="codigoproposta"
                        placeholder="Insira o código da proposta" required>
                </div>
                <div class="form-group">
                    <label for="nomefantasia">Nome da Empresa</label>
                    <input type="text" class="form-control" id="nomefantasia" placeholder="Insira o Nome da Empresa"
                        required>
                </div>
                <div class="form-group">
                    <label for="saudacao">Saudação</label>
                    <select class="form-control" id="saudacao" required>
                        <option disabled selected>Selecione</option>
                        <option>Sr.</option>
                        <option>Sra.</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="nomecliente">Nome do Cliente</label>
                    <input type="text" class="form-control" id="nomecliente" placeholder="Insira o Nome do Cliente"
                        required>
                </div>
                <div class="form-group">
                    <label for="cidadeproposta">Nome da Cidade</label>
                    <input type="text" class="form-control" id="cidadeproposta" value="Belo Horizonte"
                        placeholder="Insira o Nome da Cidade" required>
                </div>
                <div class="form-group">
                    <label for="datafundacao">Data da Proposta</label>
                    <input type='text' class="form-control input-data hoje" id='datafundacao' required>
                </div>
                <div class="form-group">
                    <label for="ultimosexercicios">Últimos Exercícios</label>
                    <input type="text" class="form-control ultimos3anos" id="ultimosexercicios" placeholder="" required>
                </div>
                <div class="row">
                    <div class="col-md-4 col-12 form-group">
                        <label for="valorass">Valor na Assinatura</label>
                        <input type="text" class="form-control reais" id="valorass" placeholder="" required>
                    </div>
                    <div class="col-md-4 col-12 form-group">
                        <label for="valorent">Valor na Entrega</label>
                        <input type="text" class="form-control reais" id="valorent" placeholder="" required>
                    </div>
                    <div class="col-md-4 col-12 form-group">
                        <label for="valortotal">Valor Total</label>
                        <input type="text" class="form-control reais" id="valortotal" placeholder="" required>
                    </div>
                </div>
                <div class="form-group">
                    <label for="impostos">Impostos</label>
                    <select class="form-control" id="impostos" required>
                        <option disabled selected>Selecione</option>
                        <option value="com">Valor com imposto</option>
                        <option value="sem">Valor sem imposto</option>
                    </select><br />
                    <small class="text-info" id="resultadoimposto"></small>
                </div>
                <input class="btn btn-primary btn-lg btn-block" type="submit" id="gerar" value="Gerar Proposta">
            </form>
            <br />
            <div class="btn btn-success btn-lg btn-block" style="display: none;" id="acessarproposta">Acessar Proposta
                Docs</div>
            <div class="btn btn-warning btn-lg btn-block" style="display: none;" id="acessarpdf">Acessar Proposta PDF
            </div>
        </div>
    </div>
    <div id="waitasec" style="display: none;" class="waitasec">
        <img style="position: absolute; left: 40%; top: 40%;"
            src="https://www.tekkno.com.br/loja/assets/img/carregando.jpg" alt="" width="200">
    </div>
    <script src="../script.js"></script>
    <script src="propostas.js"></script>
    <script>

        $(function () {
            $('#valorent').on("change", function () {
                $('#valorent').val(numeral($('#valorent').val()).format('$0,0.00'))
                let valor = numeral($('#valorass').val()).value() + numeral($('#valorent').val()).value()
                $('#valortotal').val(numeral(valor).format('$0,0.00'))
            })
        })

        $(function () {
            $('#valorass').on("change", function () {
                $('#valorass').val(numeral($('#valorass').val()).format('$0,0.00'))
                let valor = numeral($('#valorass').val()).value() + numeral($('#valorent').val()).value()
                $('#valortotal').val(numeral(valor).format('$0,0.00'))
            })
        })
        function novaProposta(e) {

            e.preventDefault()

            $("#gerar").attr("disabled", true)
            $("#waitasec").show()

            var array1 = getDataForm("form")

            function success(url) {
                $("#waitasec").hide()
                $("#acessarproposta").show()
                $("#acessarproposta").attr("link", url.url1)
                $("#acessarpdf").show()
                $("#acessarpdf").attr("link", url.url2)
                alert("Proposta Gerada")
            }

            function failure(e) {
                $("#waitasec").hide()
                $("#gerar").attr("disabled", false)
                alert("Erro em gerar proposta.")
                console.error(e)
                console.log("Envie esse código ao setor de Tecnologia:")
                console.log(getDataForm("form"))
            }

            var url = "https://script.google.com/macros/s/AKfycbx9wDkstPLn8aS06N4iMMuE6ItVEBG_ZEv4ayh-92jrEpCtA9A0/exec?key=123&user=ninguem&func=VMPV01&array1=" + array1

            $.getJSON(url, function (data) {
                success(data)
            }).done(function () {

            }).fail(function (e) {
                failure(e)
            })
            return false
        }
    </script>
</body>

</html>