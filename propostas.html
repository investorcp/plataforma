<!-- Desenvolvido por Paulo Moisés. Em dúvidas sobre a edição, entre em contato pelo site: www.paulomoises.com ou pelo email: paulomoises_silva@hotmail.com -->
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/numeral.js/2.0.6/numeral.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/numeral.js/2.0.6/locales/pt-br.min.js"></script>
<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyArffpRRcX7uR27n-g_CrYsQk_ZlFT9_iw&libraries=places"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/datepicker/0.6.5/datepicker.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/datepicker/0.6.5/datepicker.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.js"></script>
<div class="card">
    <div class="card-header">
        <h4 id="prospectNome">Propostas do Prospect </h4>
    </div>
    <div class="card-body" id="principal">
        <div class="d-flex flex-row">
            <button class="p-2 btn btn-primary" onclick="acessarCliente(event)">Acessar Cliente</button>
            <button id="acessarPasta" class="p-2 btn btn-warning" url="" onclick="openPasta(event)">Acessar Pasta</button>
        </div>
        <!-- <div class="row">
            <div class="form-group col-md-6 col-12">
                <label for="pesquisa">Nome da empresa</label>
                <input id="pesquisa" type="text" class="form-control" placeholder="Procure pelo nome da empresa">
            </div>
            <div class="form-group col-md-6 col-12">
                <label for="statuscliente">Status</label>
                <select class="form-control" id="statuscliente">
                    <option value="cliente" selected>Todos</option>
                    <option value="clienteativo">Ativos</option>
                    <option value="clienteinativo">Inativos</option>
                </select>
            </div>
        </div> -->
        <div class="row clienteT" clienteID="">
            <div class="col-md-1 col-12">Código da Proposta</div>
            <div class="col-md-1 col-12">Código do Cliente</div>
            <div class="col-md-4 col-12">Nome do Cliente</div>
            <div class="col-md-4 col-12">Tipo de Proposta</div>
            <div class="col-md-2 col-12">Valor Total</div>
        </div>
    </div>
    <div id="teste"></div>
</div>
<div id="waitasec" class="waitasec">
    <img style="position: absolute; left: 40%; top: 40%;" src="https://www.tekkno.com.br/loja/assets/img/carregando.jpg" alt="" width="200">
</div>
<style>
    .waitasec {
        position: fixed;
        left: 0px;
        top: 0px;
        width: 100vw;
        height: 100vh;
        background-color: rgba(19, 40, 78, 0.9);
        cursor: wait;
    }
    
    .cliente:hover {
        background-color: rgba(19, 40, 78, .255)
    }
    
    .more-details {
        display: none;
    }
    
    .cliente {
        border: 1px solid rgba(0, 0, 0, .125);
        padding: 15px;
        margin: 10px;
        border-radius: 15px;
        line-height: 120%;
    }
    
    .clienteT {
        border: 1px solid rgba(0, 0, 0, .125);
        background-color: rgba(19, 40, 78, .255);
        padding: 15px;
        margin: 10px;
        border-radius: 15px;
        line-height: 120% !important;
        text-align: center;
    }
    
    .dado {
        line-height: 250% !important;
    }
    
    .clienteativo {
        background-color: rgba(121, 180, 66, .255)
    }
    
    .clienteinativo {
        background-color: rgba(197, 27, 27, 0.255)
    }
</style>
<script>
    var idCliente = ""
    var dados = ""

    // Utilizar link parecido com API para acessar as coisas....
    // $(document).ready(function() {
    //     var url = window.location.href
    //     var cods = url.split('?')
    //     var tip = cods[1].split('&')
    //     console.log(tip)
    // })

    function acessarCliente(event) {
        var div = $(event.target)
        $.cookie('clientID', window.idCliente, {
            expires: 7,
            path: '/'
        });
        var win = window.open("/client")
    }

    function openPasta(event) {
        var url = $(event.target).attr('url')
        window.open(url)
    }
    $(function() {
        var id = $.cookie('clientID')
        window.idCliente = id

        var url = "https://script.google.com/macros/s/AKfycbx9wDkstPLn8aS06N4iMMuE6ItVEBG_ZEv4ayh-92jrEpCtA9A0/exec?key=123&user=ninguem&func=getClientById&id=" + id

        $.getJSON(url, function(data) {
            var dados = data.cliente
            showClient(dados)
        }).done(function() {
            $("#waitasec").hide()
        }).fail(function() {
            $("#waitasec").hide(400)
        })

        $.removeCookie('clientID')
    })

    function expandDados(event) {
        var div = $(event.target)
        var parent = $(div).parents(".cliente")
        var divH = $(parent).children(".more-details")
        var tipo = $(div).prop("tagName")
        if (tipo != "BUTTON") {
            $(divH).toggle(100)
        }
    }

    function showClient(dados) {
        window.dados = dados
        $("#prospectNome").append(dados[2])
        $("#acessarPasta").attr("url", dados[11])
    }

    $.getJSON("https://script.google.com/macros/s/AKfycbx9wDkstPLn8aS06N4iMMuE6ItVEBG_ZEv4ayh-92jrEpCtA9A0/exec?key=123&user=ninguem&func=getAllClientsData",
        function(dados) {
            $("#waitasec").hide()
            var cli = dados.clientes
            var cab = cli.shift()
            cli.forEach(e => {
                var class1 = e[9] == 1 ? "clienteativo" : "clienteinativo"
                var site = (e[8]).split(":")
                var site = e[8] == "" ? "" : (site[0] == "http" ? e[8] : "http://" + e[8])
                var dado = `<div class="row cliente ${class1}" onclick="expandDados(event)" clienteID="${e[0]}" clientName="${e[2]}">
                        <div class="col-md-1 col-1 dado">${e[0]}</div>
            <div class="col-md-3 col-12 dado">${e[2]}</div>
            <div class="col-md-3 col-12 dado">${e[4]}</div>
            <div class="col-md-2 col-12 dado">${e[6]}</div>
            <div class="col-md-3 col-12 dado"><a href="mailto:${e[7]}">${e[7]}</a></div>
            <div class="more-details row col-md-12 col-12">
                <button class="btn btn-success" onclick="acessarPropostas(event)">Acessar Proposta no Docs</button>
                <button class="btn btn-primary" onclick="acessarCliente(event)">Download Proposta PDF</button>
                <button class="btn btn-warning" url="${e[11]}" onclick="openPasta(event)">Editar Proposta Plataforma</button>
            </div>
            </div>`
                $("#principal").append(dado)
            });
            atualizarCookies()
        })
</script>